# 2024 面试准备

# 2、集合部分面试题

## 数组

### 具体问题

- Java 高效拷贝数组
- 数组下标查找在内存中是如何查找的？为什么是 O（1）的复杂度？
- 有个string数组，里面有些空的值，我想去除空的，怎么做

### 思考方向

- 不是集合，只是比较相关，所以放这里一起讲

- 二维数组的写法

  - 声明和初始化

    ```java
    int[][] arr = {{1,2},{3,4,5}}; // 内部的数组长度可相同，也可以不同
    int[][] arr2 = new int[2][2];
    int[][] arr3 = new int[2][]; // 二维变长数组，第二个长度声明时可以不指定
    ```

- Arrays 工具类

  - 常用方法

    - sort() 排序

    - fill() 填充

    - binarySearch() 二分查找

    - equals() 判等

      - 入参是两个同类型数组（用法类似 Objects.equals()，入参是两个对象）

    - hashcode() 求哈希值

    - toString() 转字符串

    - stream() 转 Stream 流（Java 8）

      - 去除 String[] 中的 null:

        ```java
        return Arrays.stream(arr)
            .filter(Objects::nonNull) // 这里用了一下 Objects.nonNull(obj) 方法，实现就是 return obj != null;
            .toArray(String[]::new); // 注意 toArray 用法
        ```

    - 高效拷贝数组

      - Arrays.copyOf()
        - 入参指定原数组、返回元素个数
      - Arrays.copyOfRange()
        - 入参指定原数组、开始索引、结束索引
      - System.arraycopy()
        - 前面两个基于这个方法实现
        - 入参指定原数组、原开始索引、目标数组、目标开始索引、长度

- 内存结构

  - 数组是一种引用内存，数组引用变量只是一个引用，数组元素和数组变量在内存里是分开存放的。
    - 实际的数组对象（即数组元素）被存放在堆内存（heap）中
    - 数组的引用变量（即数组对象）被存储在栈内存中。
  - 数组对象如果重新赋值，那么数组对象重新指向新的实际数组的地址值
  - 初始化的时候，根据数组的长度开辟对应大小的连续内存空间，访问的时候使用索引时间复杂度 O（1）

- 常见异常

  - 数组脚标越界异常 (ArrayIndexOutOfBoundsException)

- 协变

  - 子类数组是父类数组的子类型

  - 因为数组对象的类型是在运行期确定下来的。这个过程并没有主动使用运行期确定下来的类，因此不会引起类的加载。

  - 顺便提下逆变（也叫逆协变）

    - 父类泛型是子类泛型的子类

    - 很奇怪，但是记住使用场景：假如 Java 泛型可以逆变的话，可以有以下写法：

      ```java
      Comparator<Dog> dogComparator = new Comparator<Animal> {
          int compare(a: Animal, b: Animal) {
              // 比较逻辑。假如 Comparator<> compare() 入参逆变
          }
      };
      List<Dog> dogList = new List<Animal>; // 假如 List<> 实现一个入参逆变的 add()
      ```

      - 实际代码里，Java 无法在泛型定义协变逆变，只能用 extends、super 上下界通配符在使用点模拟协变逆变

        ```java
        List<? extends Number> list = new ArrayList<Integer>();
        List<? super Integer> li = new ArrayList<Number>();
        ```

    - 函数的参数不是不变的话，必须是逆变的；而返回值不是不变的话，必须是协变的

### 相关知识点

- JVM：数组相关底层实现
- 泛型：协变、逆变

## 集合

### 具体问题

- 说一下堆、栈，队列、集合之间的区别？对了解过上面这些的源码实现吗？
- Java 的集合都有哪些，都有什么特点？
- Java 的集合类有了解么
- Java中常用的集合类 (先说Collection和Map接口，再分别说子接口和实现类，以及大概的区别，没让细讲源码)
- 有一组数据，需要按照顺序对它进行加密，如果用集合做的话你会选哪个集合？比如一个数组，其元素本身无序，每个元素是字母或者数字都行，对它从小到大进行排序，你会选哪个集合去存储？  (我当时好像选的TreeMap？忘记了...)
- 三大集合的区别
- 非线程安全的集合怎么改为线程安全、
- 集合框架中的线程安全类你知道那些；
- 有哪些线程安全的集合类，讲一讲原理（HashTable，ConcurrentHashMap，CopyOnWriteArrayList）
- List，Map，Set接口在取元素时，各有什么特点
- HashSet，TreeMap
- 讲一下 `ArrayList` 和 `HashMap` 底层数据结构，优缺点，使用方式。
- 说说常用的容器和各自的特点
- 对集合有什么了解？`List` 和 `Set` 的区别？`ArrayList`、`LinkedList`以及两者区别？`HashMap` 和 `TreeMap` 的区别？
- HashMap 的位操作，HashSet 的 contains 方法复杂度是多少，红黑树简单讲一下？
- **快速失败(fail-fast)和安全失败(fail-safe)的区别是什么**

### 思考方向

- 分类
  - 三大集合：List、Set、Map（三大集合但有四个，还有个 Queue 一般提的少）
  - Collection 接口
    - List 接口：列表，元素可重复
      - **ArrayList 类**
      - **LinkedList 类**
      - **Vector 类**
        - Stack 类
      - **juc.CopyOnWriteArrayList 类**
    - Queue 接口：队列，先进先出，元素可重复
      - **PriorityQueue 类**
      - juc.ConcurrentLinkedQueue 类
      - **juc.BlockingQueue 接口：阻塞队列**
        - juc.ArrayBlockingQueue 类
        - juc.LinkedBlockingQueue 类
        - juc.SynchronousQueue 类
        - juc.PriorityBlockingQueue 类
        - juc.DelayQueue 类
        - juc.BlockingDeque 接口（继承了 juc.BlockingQueue、Deque 两个接口）
          - juc.LinkedBlockingDeque
      - **Deque 接口：双端队列**
        - **LinkedList 类**
        - **ArrayDeque 类**
        - juc.ConcurrentLinkedDeque 类
        - juc.BlockingDeque 接口（继承了 juc.BlockingQueue、Deque 两个接口）
    - Set 接口：集，不重复
      - **HashSet 类**
      - **LinkedHashSet 类**
      - SortedSet 接口
        - NavigableSet 接口
          - **TreeSet 类**
          - juc.ConcurrentSkipListSet 类
  - Map 接口：键值对，key 无序、不重复；value 无序、可重复
    - **HashMap 类**
    - **LinkedHashMap 类**
    - WeakHashMap 类
    - **HashTable 类**
    - juc.ConcurrentMap 接口
      - **juc.ConcurrentHashMap 类**
      - juc.ConcurrentNavigableMap 接口
        - juc.ConcurrentSkipListMap 类
- fail-fast、fail-safe
  - 快速失败（fail-fast）
    - 在用迭代器遍历一个集合对象时，如果遍历过程中对集合对象的结构进行了修改（增加、删除），则会抛出**Concurrent Modification Exception**（并发修改异常）。
    - 在多线程和单线程环境下都有可能出现快速失败
    - 举例 ArrayList、HashMap
    - 原理
      - 每次调用 next() 方法，在实际访问元素前，都会调用 checkForComodification() 方法
      - 检查集合迭代器实现类的 modCount 属性（修改次数）是否变了
    - 如何避免
      - 单线程 remove() 删除迭代到的当前元素，使用迭代器的而不是集合类的
      - 直接使用安全失败的 JUC 包集合替代
  - 安全失败（fail-safe）
    - 采用安全失败机制的集合容器，在遍历时不是直接在集合内容上访问的，而是先复制原有集合内容，在拷贝的集合上进行遍历。
    - 举例 CopyOnWriteArrayList、ConcurrentHashMap

### 相关知识点

- 数据结构：堆或者优先队列（PriorityQueue 类）、跳表（juc.ConcurrentSkipListMap、juc.ConcurrentSkipListSet 类）
- JVM：强、弱、软、虚引用（WeakHashMap 类）
- 多线程：线程安全、线程池（阻塞队列）
  - juc 包的集合
  - Collections.synchronizedList()、Collections.synchronizedSet()、Collections.synchronizedMap()
- 具体各个集合详情细节，参考其他具体描述

## List

### 具体问题

- 怎么实现一个栈的呢？
- Java 里的队列用过吗？
- ArrayList和LinkedList区别
- ArrayList 和 LinkedList 区别
- ArrayList 和 LinkedList 的区别？
- arraylist、linkedlist区别
- arraylist 和 linkedkist
- 集合类说一下， 说一下ArrayList 和 LinkedList， ArrayList为什么用数组，怎么扩容， 为什么扩容的时候新建数组，而不是数组去扩容。
- 说一下ArrayList和LinkedList区别，然后讲了大量数据下在LinkedList前1/10处插入效率高，在ArrayList中部以及后部插入效率高，解释原因。
- arraylist和linkedlist区别
- arraylist和linkedlist使用场景 `【2次】`
- arraylist和linkedlist区别？
- ArrayList 和 LinkedList 的区别？ArrayList 的扩容方式？
- `ArrayList`、`LinkedList` 是线程安全的吗？(简单提了一下)
- list和数组区别，哪个会内存泄漏，查询的话哪个快点。我觉得查询是一样快的，因为list本来底层就是数组

### 思考方向



### ArrayList

#### 具体问题

ArrayList 的扩容过程 

ArrayList  优势，扩容，什么时候用

ArrayList 的扩容机制

 Arraylist线程安全吗？有其他数据结构是线程安全的吗？

讲到ArrayList，讲一下初始长度，扩容机制。

链表和数组的区别，提到 ArrayList，讲一下插入删除和扩容

arraylist如何去重？面试官：既然你说看过hashmap源码那我就不问了（？？看过源码就不问？就不怕我乱写的吗）

**ArrayList实现了哪些接口**
**说了List、Cloneable、Serializable，我觉得他应该是想问RandomAccess接口，当时没回答上这个**



### LinkedList

#### 具体问题

数组和链表区别

LinkedList  优势，什么时候用，和arraylist的区别 等等

LinkedList 实现

## Queue

### 具体问题

`Queue` 与 `Deque` 的区别？

## Set

### 具体问题

为什么 HashSet 对一个对象去重的时候要重写 hascCode() 和 equals() 方法？（HashSet 的去重流程）

## Map

### 具体问题

Java 中的 Map 都有哪些实现？

Map 有哪几个实现？分别有什么特点？

Java里的Map有哪几种实现(HashMap | TreeMap | HashTable | LinkedHashMap | ConcurrentHashMap)

Hash 方式和 Hash 冲突解决

hashtable hashmap synchronizedmap concurrentmap(细说，这里我紧张，面试官开始引导我，爱了！！！)

HashMap，HashTable，ConcurrentHashMap的区别。

极高并发下HashTable和ConcurrentHashMap哪个性能更好，为什么，如何实现的。

ConcurrentHashMap 和 HashTable

### HashMap

#### 具体问题

HashMap 底层原理

HashMap原理，底层结构，1.7和1.8区别，头插法还是尾插法、线程安全吗

HashMap的源码，实现原理，JDK8中对HashMap做了怎样的优化。

如果让你自己实现哈希表，你会考虑什么问题？

介绍一下 HashMap

讲一下 HashMap 的源码？

Hashmap 源码看过吗？讲讲 hashmap 怎么实现的？

HashMap八股（数据结构，扩容，链表和红黑树转换）

Hashmap 源码级掌握，扩容，红黑树，最小树化容量，hash冲突解决，有些面试官会提出发自灵魂的审问，比如为什么是红黑树，别的树不可以吗；为什么8的时候树化，4不可以吗，等等      

HashMap 源码实现

阅读过哪些集合源码？重点提了hashmap的哈希算法

那你说一说hashmap的实现(这里非常详细的展开说了实现原理）

Hashmap 的底层原理，有哪些遍历方式？

HashMap 底层实现

HashMap，扩容过程，怎么解决哈希冲突？

HashMap1.8优化在哪些方面？

hashmap1.7 、1.8底层结构区别

HashMap 1.7和1.8区别

HashMap原理,put和resize过程

HashMap的时间复杂度？HashMap中Hash冲突是怎么解决的？Java8中的HashMap有什么变化？

红黑树需要比较大小才能进行插入，是依据什么进行比较的？其他Hash冲突解决方式？



#### 线程安全

##### 具体问题

HashMap 有了解么，它的底层实现，为什么线程不安全，想要线程安全有什么措施

hashmap线程安全实现

HashMap 是否线程安全,如果需要使用线程安全的呢

HashMap不是线程安全的，如果要保证线程安全怎么办呢？可以用什么？

HashMap 并发的时候会有什么问题

怎么让 HashMap 并发安全

有几种方法可以让 HashMap 变得线程安全

HashMap是线程安全的吗？为什么呢？

那hashmap安全吗？(不安全，我们可以用blabla...)

HashMap 多线程下，怎么个个不安全法，数据丢失问题

问我HashMap是不是线程安全的，为什么不安全，会出现哪些问题，我讲了扩容出现环死循环，然后问我死循环cpu的状态是怎么样的，我答是100%，然后问我死循环其他线程能不能使用cpu，然后又问比如一个四核cpu占有率又是多少，cpu100%对整个服务器有什么影响。 

`HashMap` 是线程安全的吗？为什么不安全？(不知道。没答上来)多个线程同时执行`put` 方法可能会发生数据覆盖问题

#### get()

##### 具体问题

HashMap 查找效率最低和最高

如果一个hashmap有一亿条数据怎么实现高效查找; 答：可以考虑优化hash函数减少碰撞(事后大佬指点分布不均匀的话更好的应该是进行分层)



#### put()

##### 具体问题

说一下 HashMap 的底层和 put 方法

hashMap put get过程



#### 扩容

##### 具体问题

HaspMap扩容是怎样扩容的，为什么都是2的N次幂的大小。

`new Hashmap<1000>` 和 `new Hashmap<10000>` 在数据都塞满的时候有什么区别？（提示 扩容相关）

HashMap 扩容了解吗?说一下扩容因子(loadFactor)

为什么负载因子是0.75（这里我提到了redis的负载因子是1或者5，但没有追问redis的hashmap）

如果hashmap溢出了怎么办（建立公共溢出区？）
.公共溢出区也满了怎么办？（啊…？这我真的盲区了，我说hashmap也会扩容吧…？）

HashMap 的扩容，JDK 1.7和 JDK 1.8 扩容的区别

说一下hashmap扩容的过程？

HashMap 在 1.8 前后的区别？链表可能转成红黑树有什么好处？

hashmap扩容方面做了哪些优化？我只答出了红黑树。

Map：只存60个键值对，需要设置初始化容量吗？设置的话设置多少初始化容量：需要 否则需要多次扩容 128 要考虑数组长度是2的幂次方、负载因子

hashmap原理,扩容,问了我hashmap怎么缩容(这里应该说红黑树退化链表的，hashmap没有缩容，我还以为自己记错了)

HashMap 扩容（还争了一会为啥要2倍……我说左移右移方便，他说核心是2的倍数……我觉得不都一个意思吗）、put 的过程

hashmap 为什么是两倍扩容

#### 红黑树

##### 具体问题

HashMap 为什么不考虑 AVL 树(AVL 性能消耗更大)

讲讲红黑树

hashmap 为什么使用的是红黑树不是其他树

hashmap，为什么要转成红黑树，不是一开始就用（红黑树的缺点）

HashMap底层为什么要用红黑树呢？为什么不用平衡二叉树？

HashMap 源码实现，链表转红黑树条件，红黑树是否会退化为链表

hashmap什么时候退回回链表？为什么不是7

Map ,hashmap底层实现？链表过长怎么办？红黑树特点 复杂度

HashMap底层数据结构是什么

HashMap的底层原理`【2次】`

hashmap的结构

HashMap的底层数据结构？链表长度大于8就会转化成红黑树吗，没有对数组的插入有要求吗？链表是双向链表还是单向链表？

HashMap 的底层， 跟hashtable有什么区别？

HashMap先不考虑红黑树，手写一个底层数据结构，存储key value

平衡二叉树？hashmap底层实现，红黑树特点？

集合类，HashMap 的底层结构，为什么使用红黑树

`HashMap` 的底层数据结构

HashMap的数据结构怎么样的，我就说了一下 数组和链表这种，不知道是不是他的意思
key可否null，为什么
是否线程安全，否则会发生什么情况 

#### hash 与哈希冲突

##### 具体问题

hashmap原理，处理哈希冲突用的哪种方法？

Rehash 具体会影响什么？哈希结果会受到什么影响？

Rehash 过程中存放在旧桶的元素如何迁移？

HashMap 源码中，计算 hash 值为什么有一个 高 16 位 和 低 16 位异或的过程？

取模的时候为什么用&(length-1)

容量不是2的整数次幂 还用&(length-1) 影响会怎样？：容量是2的整数次幂，n -1 后，高位为1后的0都变为1，如 16：10000, 16-1=15：1111, 1111 再与 hash 做 & 运算的时候，各个位置的取值取决于 hash；如果不是2的整数次幂，必然会有的0的位，0与任何数&肯定为0，会造成更多的哈希冲突

HashMap在遇到key冲突的时候是怎么处理的呢？

HashMap 源码，数据结构，如何避免哈希冲突，对比 HashTable

hashmap怎么解决hash冲突
除了链地址法还有其他的解决hash冲突的方法吗（开放定址和再哈希）

### ConcurrentHashMap

#### 具体问题

HashMap、ConcurrentHashMap 底层

ConcurentHashMap在什么地方加的锁，1.7和1.8区别，1.7用的segment，1.8用的synchronized

ConcurrentHashMap原理，为什么多线程条件下性能这么好
我从sync在1.6做的优化谈的，他从锁的粒度方面谈的

HashMap、ConcurrentHashMap 的区别？扩容过程是怎么样的？

ConcurrentHashMap 的底层实现

ConcurrentHashMap为什么是线程安全的？

HashMap 和 ConcurrentHashmap 的区别

你对集合那么熟悉，看过哪些源码？HashMap，HashTable，ConcurrentHashMap等等

看过哪些源码，（hashmap，concurrenthashmap，hashtable），那你说说各自的特点。（把concurrenthashmap和hashtable说混了，面完了才想起）

说下hashmap/hashtable/concurrenthashmap，说底层了；

HashMap，ConcurrentHashMap，说了ConcurrentHashMap的1.7和1.8的不同和具体实现

HashMap、Hashtable、ConcurrentHashMap的比较（扯了Hashtable不绝对安全）

hashmap counrrenthashmap 要求从源码上解释。如果两个同样的put相同的key，会发生什么？

HashMap和ConcurrentHashMap

HashMap和ConcurrentHashMap哪个效率更高？为什么？

ConcurrentHashMap和HashMap

concureentHashMap，段锁，如何分段，和hashmap在hash上的区别，性能，等等

### HashTable

#### 具体问题

hashmap、hashtable区别

HashMap、HashTable

HashMap和HashTable区别

HashMap和Hashtable区别，我特意提了哈希算法不一样，各自的算法原理，提问：为什么不一样？

Hashtable为什么不用HashMap的？

HashTable ，同步锁，这块可能会问你synchronized关键字 1.6之后提升了什么，怎么提升的这些

HashTable如何实现线程安全（给每个方法加synchronized，put时只能有一个线程获取到锁）

### LinkedHashMap

#### 具体问题

LinkedHashMap的使用场景 (用LinkedHashMap实现lru，按插入顺序(默认) accessOrder = false | 按访问顺序 accessOrder = true，HashMap+双向链表)

### TreeMap

#### 具体问题

`HashMap` 和 `TreeMap` 区别?

TreeMap的使用场景，底层数据结构，红黑树的存取复杂度

TreeMap 了解吗，是如何保证 Map 中的 Key 是有序的